<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://leowll.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="Tech &amp; Life">
<meta property="og:type" content="website">
<meta property="og:title" content="Leo&#39;s notepad">
<meta property="og:url" content="http://leowll.com/index.html">
<meta property="og:site_name" content="Leo&#39;s notepad">
<meta property="og:description" content="Tech &amp; Life">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Leo&#39;s notepad">
<meta name="twitter:description" content="Tech &amp; Life">

<link rel="canonical" href="http://leowll.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Leo's notepad</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Leo's notepad</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">yet another blog</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2019/09/03/20190903-spring-batch-async-job/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/03/20190903-spring-batch-async-job/" class="post-title-link" itemprop="url">Spring Batch执行异步Job的方法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-03 13:33:00" itemprop="dateCreated datePublished" datetime="2019-09-03T13:33:00+09:00">2019-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-04 13:33:32" itemprop="dateModified" datetime="2019-09-04T13:33:32+09:00">2019-09-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/09/03/20190903-spring-batch-async-job/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/09/03/20190903-spring-batch-async-job/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>Spring Batch默认的JobLauncher执行Job的方式是同步的。<br>如果需要执行异步Job，则需要定义能执行异步Job的JobLauncher。</p>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><ol>
<li><p>在Configuration Class中定义SimpleJobLauncher, 设置其TaskExecutor为异步的SimpleAsyncTaskExecutor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableBatchProcessing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SimpleJobLauncher <span class="title">simpleJobLauncher</span><span class="params">(JobRepository jobRepository)</span></span>&#123;</span><br><span class="line">	    SimpleJobLauncher jobLauncher = <span class="keyword">new</span> SimpleJobLauncher();</span><br><span class="line">	    jobLauncher.setJobRepository(jobRepository);</span><br><span class="line">	    jobLauncher.setTaskExecutor(<span class="keyword">new</span> SimpleAsyncTaskExecutor());</span><br><span class="line">	    <span class="keyword">return</span> jobLauncher;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在调用Launcher的主程序中设置自动注入，就可以使用了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SimpleJobLauncher simpleJobLauncher;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Job job1;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Job jo2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	logger.info(<span class="string">"##### run async jobs #####"</span>);</span><br><span class="line">	simpleJobLauncher.run(job1, jobParameters);</span><br><span class="line">	simpleJobLauncher.run(job2, jobParameters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2019/05/29/20190529-gradle-exclude-war/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/29/20190529-gradle-exclude-war/" class="post-title-link" itemprop="url">Gradle排除war中特定依赖的方法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-05-29 14:29:50 / Modified: 14:29:47" itemprop="dateCreated datePublished" datetime="2019-05-29T14:29:50+09:00">2019-05-29</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/05/29/20190529-gradle-exclude-war/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/05/29/20190529-gradle-exclude-war/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在往SAP Cloud Platform Neo上部署war文件后，有时会出现程序无法启动的错误。<br>通过排查错误日志，发现log中有类似下面的描述：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2019 05 28 09:31:00#+00#ERROR#org.slf4j.helpers.Util##anonymous#localhost-startStop-1#na#xxxx#sampleapp#web##na#na#na#na#SLF4J: Class path contains multiple SLF4J bindings. |</span><br><span class="line">2019 05 28 09:31:00#+00#ERROR#org.slf4j.helpers.Util##anonymous#localhost-startStop-1#na#xxxx#sampleapp#web##na#na#na#na#SLF4J: Found binding in [jar:file:/usr/sap/ljs/bin/logback-classic.jar!/org/slf4j/impl/StaticLoggerBinder.class] |</span><br><span class="line">2019 05 28 09:31:00#+00#ERROR#org.slf4j.helpers.Util##anonymous#localhost-startStop-1#na#xxxx#sampleapp#web##na#na#na#na#SLF4J: Found binding in [jar:file:/usr/sap/ljs/webapps/spring-boot-Olingo-oData-master/WEB-INF/lib/logback-classic-1.1.2.jar!/org/slf4j/impl/StaticLoggerBinder.class] |</span><br><span class="line">2019 05 28 09:31:00#+00#ERROR#org.slf4j.helpers.Util##anonymous#localhost-startStop-1#na#xxxx#sampleapp#web##na#na#na#na#SLF4J: See http://www.slf4j.org/codes.html\#multiple_bindings for an explanation. |</span><br><span class="line">2019 05 28 09:31:00#+00#ERROR#org.slf4j.helpers.Util##anonymous#localhost-startStop-1#na#xxxx#sampleapp#web##na#na#na#na#SLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]</span><br></pre></td></tr></table></figure></p>
<p>仔细观察发现该错误是slf4j和logback的依赖冲突导致的。</p>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><p>通过参考<a href="http://www.zhyea.com/2018/02/08/gradle-exclude-dependencies.html" target="_blank" rel="noopener">gradle-exclude-dependencies</a>这篇文章，尝试了如下解决办法：</p>
<h2 id="Dependency局部排除"><a href="#Dependency局部排除" class="headerlink" title="Dependency局部排除"></a>Dependency局部排除</h2><p>通过对spring boot的依赖添加exclude描述来排除特定依赖。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span>(<span class="string">"org.springframework.boot:spring-boot-starter-web:$&#123;project.bootVersion&#125;"</span>)&#123;</span><br><span class="line">	<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'org.slf4j'</span>, module: <span class="string">'slf4j-api'</span></span><br><span class="line">	<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'ch.qos.logback'</span>, module: <span class="string">'logback-classic'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">compile</span>(<span class="string">"org.springframework.boot:spring-boot-starter-actuator:$&#123;project.bootVersion&#125;"</span>)&#123;</span><br><span class="line">	<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'org.slf4j'</span>, module: <span class="string">'slf4j-api'</span></span><br><span class="line">	<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'ch.qos.logback'</span>, module: <span class="string">'logback-classic'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Configuration全局排除"><a href="#Configuration全局排除" class="headerlink" title="Configuration全局排除"></a>Configuration全局排除</h2><p>在全局配置中通通排除相关依赖。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">configurations</span> &#123;</span><br><span class="line">	all*.<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'org.slf4j'</span>, module: <span class="string">'slf4j-api'</span></span><br><span class="line">	all*.<span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'ch.qos.logback'</span>, module: <span class="string">'logback-classic'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="providedRuntime打包时排除"><a href="#providedRuntime打包时排除" class="headerlink" title="providedRuntime打包时排除"></a>providedRuntime打包时排除</h2><p>上述两种方法能够解决问题，但是本地执行的时候却会报错，原因是Tomcat Embedded还是需要被排除的那些依赖。<br>怎样让gradle打包的时候排除这些依赖呢？gradle提供了providedRuntime和providedCompile等写法。<br><a href="https://docs.gradle.org/current/userguide/war_plugin.html" target="_blank" rel="noopener">The War Plugin</a><br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">providedRuntime(<span class="string">"org.slf4j:slf4j-api"</span>)</span><br><span class="line">providedRuntime(<span class="string">"ch.qos.logback:logback-classic"</span>)</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/08/20/20180820-mi-note3-kddi-au/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/20/20180820-mi-note3-kddi-au/" class="post-title-link" itemprop="url">让你的小米手机能在日本使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-20 21:54:50" itemprop="dateCreated datePublished" datetime="2018-08-20T21:54:50+09:00">2018-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-08-21 17:10:45" itemprop="dateModified" datetime="2018-08-21T17:10:45+09:00">2018-08-21</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/08/20/20180820-mi-note3-kddi-au/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/08/20/20180820-mi-note3-kddi-au/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="小米的手机能不能在日本用？"><a href="#小米的手机能不能在日本用？" class="headerlink" title="小米的手机能不能在日本用？"></a>小米的手机能不能在日本用？</h1><p>之前给老婆买了一台小米的Note3，办的是日本乐天（Rakuten Mobile）的格安SIM卡，装上之后时不时的断网。老婆一怒之下把手机扔给我说“难用死了，我要换手机！”</p>
<p><img src="https://www.jiuwa.net/tuku/20170518/YIdH0tHF.jpg" alt=""></p>
<p>然后就去日本的Yodabashi Camera办了UQ Mobile的SIM卡，还送了一台华为P10 Lite。UQ Mobile的速度比我Line Mobile的卡不知道快了多少。<br>Line Mobile 在2017年初的时候速度还挺快，后来慢慢的用的人多了？速度就降了下来，用Speedtest测的话只能达到2Mbps左右的网速。而老婆的手机却能测得20Mbps，让人眼馋。</p>
<p>我之前也是用的乐天，后来改用了Line Mobile。小米Note3貌似对日本的服务商支持不太好，我接过来之后装上也是时不时的断网。解决办法就是断网的时候就切换一下APN。看老婆的手机用的那么舒爽，于是决定也换成UQ Mobile，心想大不了也想原来一样上不了网的时候就切换一下APN嘛。</p>
<h1 id="事与愿违"><a href="#事与愿违" class="headerlink" title="事与愿违"></a>事与愿违</h1><p>事实是我想的太简单了。刚开始装上SIM卡的时候，走出Yodobashi的大楼就不能用了，后来回到家里能用了一段时间，但是在上班路上电车里却总也连不上信号。就这样无信号的过了一整天。后来干脆显示为SIM卡无法识别。。。</p>
<h1 id="折腾"><a href="#折腾" class="headerlink" title="折腾"></a>折腾</h1><p>因为一直显示不在服务区（SIM卡无法识别），我先回尝试了下面几种方法：</p>
<h2 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h2><p>刷了MIUI9的国际版，测试不通过<br>刷了MIUI10，测试不通过</p>
<h2 id="改基带"><a href="#改基带" class="headerlink" title="改基带"></a>改基带</h2><p>网上说日本和中国的运营商提供的基带不同，所以我在想是不是基带的问题。<br>UQ Mobile利用的是KDDI AU的线路，AU支持的LTE基带为<a href="https://www.frequencycheck.com/carriers/kddi-au-japan" target="_blank" rel="noopener">B1,B11,B18,B41</a><br>小米Note3<a href="https://www.mi.com/minote3/specs/" target="_blank" rel="noopener">支持的基带</a>为</p>
<ul>
<li>FDD-LTE (频段 B1，B3，B5，B7，B8)</li>
<li>TDD-LTE (频段 B34, B38，B39, B40, B41)</li>
<li>TD-SCDMA (频段 B34，B39)</li>
<li>WCDMA (频段 B1，B2，B5，B8)</li>
<li>GSM (频段 B2，B3，B5，B8)</li>
<li>CDMA1X/EVDO (频段 BC0)</li>
</ul>
<p>所以应该不是问题。</p>
<p>但还是想<a href="https://gadget.hrksv.com/2017/01/05/post-858" target="_blank" rel="noopener">通过QTool</a> 来改一下基带。</p>
<p>结果还是不行。因为我买的是小米全网通版的Note3，默认已经支持了。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>踏破铁鞋无觅处，得来全不费工夫。折腾到晚上1点，终于找到了解决方法。<br>这篇<a href="https://mymobile-wifi.com/xiaomi-mi-mix-2-cdma-lte" target="_blank" rel="noopener">日本人写的博客</a> 里提到了非常简单的解决方法：</p>
<h2 id="添加VoLTE的APN"><a href="#添加VoLTE的APN" class="headerlink" title="添加VoLTE的APN"></a>添加VoLTE的APN</h2><ul>
<li>NAME: ims</li>
<li>APN: ims</li>
<li>MCC: 440</li>
<li>MNC: 51</li>
<li>TYPE: ims</li>
</ul>
<h2 id="将VoLTE的设备检测关掉"><a href="#将VoLTE的设备检测关掉" class="headerlink" title="将VoLTE的设备检测关掉"></a>将VoLTE的设备检测关掉</h2><p>通过拨打<code>*#*#86583#*#*</code>来关掉手机的VoLTE设备检测功能。<br>拨号后带有“…disabled”的消息一闪而过，这时你在观察手机右上角的服务商标志就显示为有信号了！</p>
<p><a href="https://imgchr.com/i/P48BDg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/21/P48BDg.md.jpg" alt="P48BDg.md.jpg"></a></p>
<p>而这时你再到”设置-&gt;双卡和移动网络”中查看SIM卡信息就会发现连VoLTE高清通话功能都可用了！</p>
<p><a href="https://imgchr.com/i/P48DbQ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/21/P48DbQ.md.jpg" alt="P48DbQ.md.jpg"></a></p>
<p>现在来测一下速度吧：</p>
<p><a href="https://imgchr.com/i/P48n9x" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/21/P48n9x.md.jpg" alt="P48n9x.md.jpg"></a></p>
<p>LTE速度36+Mbps，还不错！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/06/29/deploy-spring-boot-sap-cloud-platform-neo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/29/deploy-spring-boot-sap-cloud-platform-neo/" class="post-title-link" itemprop="url">How to deploy spring boot application to sap cloud platform neo</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-30 11:59:00" itemprop="dateCreated datePublished" datetime="2018-06-30T11:59:00+09:00">2018-06-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-07-01 01:24:09" itemprop="dateModified" datetime="2018-07-01T01:24:09+09:00">2018-07-01</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/29/deploy-spring-boot-sap-cloud-platform-neo/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/29/deploy-spring-boot-sap-cloud-platform-neo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="普通Spring-Boot程序的部署"><a href="#普通Spring-Boot程序的部署" class="headerlink" title="普通Spring Boot程序的部署"></a>普通Spring Boot程序的部署</h1><p>传统的spring boot web程序，其pom.xml和main函数所在的class通常是这样的。<br>以spring boot guide提到的程序为例,通常只需要在pom中这样写就可以让程序正常执行了<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Spring Boot自带的tomcat容器，可以让程序无需依赖外面的容器，实现更好与外部环境的松耦合。<br>在诸如cloud foundry之类的环境里可以无障碍运行，但是在sap cloud platform neo环境中，<br>部署后的程序却总是无法正常运行，显示为404 not found。</p>
<h1 id="怎样将Spring-Boot程序部署在Neo上"><a href="#怎样将Spring-Boot程序部署在Neo上" class="headerlink" title="怎样将Spring Boot程序部署在Neo上"></a>怎样将Spring Boot程序部署在Neo上</h1><p>查来查去在网上找到了sap自己给出的sample，比对了半天发现问题出在pom.xml和main函数的写法上。<br><a href="https://www.sap.com/developer/tutorials/spring-boot-getting-started.html" target="_blank" rel="noopener">spring-boot-getting-started</a></p>
<p>SAP给出的guide上明确的写着，</p>
<ol>
<li>pom.xml要写成这样：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- developer tools for hot code-replacement etc. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Embedded tomcat etc. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为SAP Cloud Platform的Neo环境中内置了Tomcat容器，所以当部署到Neo上去的时候，你的程序就不应该再内嵌tomcat了。</p>
<p>tomcat使用部署环境提供的tomcat，写成<strong>provided</strong>。而且Neo中也内置了<strong>logging</strong>的库，所以相应的依赖也应该写成<strong>provided</strong>。</p>
<ol start="2">
<li>main函数要写成这样：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.support.SpringBootServletInitializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">	     SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>通过查看官方的文档，明白了为什么main函数要写成上面的样子。<br><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-traditional-deployment.html" target="_blank" rel="noopener">How to traditional-deployment</a><br>官方文档中提到，</p>
<blockquote>
<p>The first step in producing a deployable war file is to provide a SpringBootServletInitializer subclass and override its configure method. Doing so makes use of Spring Framework’s Servlet 3.0 support and lets you configure your application when it is launched by the servlet container. Typically, you should update your application’s main class to extend SpringBootServletInitializer.</p>
</blockquote>
<p>翻译成中文就是，如果你想让你的程序运行在servlet容器（比如Neo中内嵌的Tomcat），你就需要让你的main函数继承<code>SpringBootServletInitializer</code>并重写其中的<code>configure</code>方法。<br>普通的Spring Boot程序不需要这么写，是因为它们不需要运行在外置的servlet容器中。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/06/09/config-pandorabox-oray-ddns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/09/config-pandorabox-oray-ddns/" class="post-title-link" itemprop="url">为Pandorabox/openwrt/lede配置花生壳DDNS</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-09 19:07:00" itemprop="dateCreated datePublished" datetime="2018-06-09T19:07:00+09:00">2018-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-06-11 14:22:24" itemprop="dateModified" datetime="2018-06-11T14:22:24+09:00">2018-06-11</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/09/config-pandorabox-oray-ddns/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/09/config-pandorabox-oray-ddns/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如果你在自己的Pandorabox/openwrt/lede上安装了aria2,你或许希望在外网能够访问自己家的服务器，这时候就要用到ddns。</p>
<p>花生壳提供的壳域名，历史悠久，便宜好用。<br>注册了花生壳域名之后，这篇文章教你怎样给自己的路由器设置DDNS。</p>
<h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><p>你家的路由器有公网的ip地址。有些家庭只有内网IP，没办法，联系电信运营商让他们给你开通吧。比如说你家要装个监控摄像头之类的。</p>
<h1 id="设置花生壳域名"><a href="#设置花生壳域名" class="headerlink" title="设置花生壳域名"></a>设置花生壳域名</h1><p>首先通过访问 <a href="http://ipinfo.io" target="_blank" rel="noopener">http://ipinfo.io</a> 这个网站，来获取自己路由器当前的ip地址。</p>
<p>获取了ip地址以后，在壳域名的设置页面</p>
<ol>
<li>打开花生壳设置</li>
<li>测试 http://[USERNAME]:[PASSWORD]@ddns.oray.com/ph/update?hostname=[DOMAIN]&amp;myip=[IP]<br>把Username，Password，DOMAIN和IP替换成自己的用户名密码，域名和IP，测试一下能否更新。</li>
</ol>
<p>有些情况下花生壳给的域名无法正常更新，原因不明。只能选择能够更新的来用了。</p>
<p><a href="https://imgchr.com/i/CbX3PU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/CbX3PU.md.jpg" alt="CbX3PU.md.jpg"></a></p>
<h1 id="设置动态DNS"><a href="#设置动态DNS" class="headerlink" title="设置动态DNS"></a>设置动态DNS</h1><p>在Pandorabox的管理界面的服务&gt;动态DNS中进行下面的设置。<br>Pandorabox自带了Oray的服务选项，也可以自定义URL</p>
<ul>
<li>自定义更新URL:http://[USERNAME]:[PASSWORD]@ddns.oray.com/ph/update?hostname=[DOMAIN]&amp;myip=[IP]<br><a href="https://imgchr.com/i/CbXl5T" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/CbXl5T.md.jpg" alt="CbXl5T.md.jpg"></a></li>
</ul>
<p>IP地址来源选择Oray提供的URL来确认本机的IP地址。</p>
<ul>
<li>用于检测的URL：<a href="http://ddns.oray.com/checkip" target="_blank" rel="noopener">http://ddns.oray.com/checkip</a></li>
</ul>
<p><a href="https://imgchr.com/i/CbXJxJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/CbXJxJ.md.png" alt="CbXJxJ.md.png"></a></p>
<h1 id="设置Web服务"><a href="#设置Web服务" class="headerlink" title="设置Web服务"></a>设置Web服务</h1><p>Web服务器默认拒绝外网访问，需要将这个限制解除</p>
<ol>
<li>编辑 /etc/config/uhttpd</li>
</ol>
<p>将<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option rfc1918_filter <span class="string">'1'</span></span><br></pre></td></tr></table></figure></p>
<p>  改为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option rfc1918_filter <span class="string">'0'</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>重启Web服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/uhttpd restart</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/06/09/config-pandorabox-ipv6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/09/config-pandorabox-ipv6/" class="post-title-link" itemprop="url">为安装了Pandorabox的小米路由器Pro配置ipv6</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-06-09 15:40:00 / Modified: 17:18:14" itemprop="dateCreated datePublished" datetime="2018-06-09T15:40:00+09:00">2018-06-09</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/09/config-pandorabox-ipv6/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/09/config-pandorabox-ipv6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考来源： <a href="http://www.cnblogs.com/Arago/p/7765873.html" target="_blank" rel="noopener">Openwrt配置NAT6</a></p>
<p>假如你家的路由器是Pandorabox（或者其他openwrt，lede）的路由器，并且你家的网络支持ipv6， 那怎样设置路由器来实现网络提速呢？<br>先来看一下我家网络的提速效果：</p>
<p><img src="https://s1.ax1x.com/2018/06/09/Cbf4c8.md.png" height="200px" alt="speed test"></p>
<p>之前家里的网络速度一直徘徊在100M以下，设置了ipv6之后，一直保持在100M左右。</p>
<h1 id="ipv6比ipv4更快吗？"><a href="#ipv6比ipv4更快吗？" class="headerlink" title="ipv6比ipv4更快吗？"></a>ipv6比ipv4更快吗？</h1><p><a href="https://www.zhihu.com/question/19570943" target="_blank" rel="noopener">ipv6比ipv4更快吗？</a></p>
<blockquote>
<p>说 IPv6 能提高「网速」通常是指新建的 IPv6 网络通常具有更大的带宽（比如中国正在新建的 CERNET2 骨干网动辄 10Gbps、100Gbps 的连接带宽）、更好的流量控制、更少的 NAT 从而实现更高效的网络拓扑结构（IP 地址资源多从而不需要对数据包进行多次地址翻译和转发）。在这些方面 IPv6 确实是能提高「网速」的。</p>
</blockquote>
<h1 id="NAT的工作原理"><a href="#NAT的工作原理" class="headerlink" title="NAT的工作原理"></a>NAT的工作原理</h1><p>当内部网络中的一台主机想传输数据到外部网络时，它先将数据包传输到NAT路由器上，路由器检查数据包的报头，获取该数据包的源IP信息，并从它的NAT映射表中找出与该IP匹配的转换条目，用所选用的内部全局地址（全球唯一的IP地址）来替换内部局部地址，并转发数据包。<br>当外部网络对内部主机进行应答时，数据包被送到NAT路由器上，路由器接收到目的地址为内部全局地址的数据包后，它将用内部全局地址通过NAT映射表查找出内部局部地址，然后将数据包的目的地址替换成内部局部地址，并将数据包转发到内部主机。<br><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Nat2.svg/300px-Nat2.svg.png" alt="nat工作原理"></p>
<h1 id="设置步骤"><a href="#设置步骤" class="headerlink" title="设置步骤"></a>设置步骤</h1><h2 id="查看-设置ipv6前缀"><a href="#查看-设置ipv6前缀" class="headerlink" title="查看/设置ipv6前缀"></a>查看/设置ipv6前缀</h2><p>在管理界面的网络&gt;接口画面可以看到</p>
<p>默认ipv6的前缀是设置好的，当然也可以自己定义一下。<br><a href="https://imgchr.com/i/CbfB6O" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/CbfB6O.md.jpg" alt="CbfB6O.md.jpg"></a></p>
<h2 id="设置DHCPv6"><a href="#设置DHCPv6" class="headerlink" title="设置DHCPv6"></a>设置DHCPv6</h2><p>在网络&gt;接口-LAN&gt;DHCP服务器中进行如下设置，使连接到网络的设备能自动获取ipv6地址：</p>
<ul>
<li>路由器通告服务： 服务器模式</li>
<li>DHCPv6服务： 服务器模式</li>
<li>DHCPv6模式： 无状态的+有状态的</li>
</ul>
<p><a href="https://imgchr.com/i/Cbfwp6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/Cbfwp6.md.png" alt="Cbfwp6.md.png"></a></p>
<h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><p>ssh进你的路由器，执行下列命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip6tables -t nat -A POSTROUTING -o eth0.2 -j MASQUERADE</span><br></pre></td></tr></table></figure></p>
<p>等同于在路由器管理界面的防火墙中添加下列NAT规则</p>
<p><a href="https://imgchr.com/i/CbfDXD" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/CbfDXD.md.png" alt="CbfDXD.md.png"></a></p>
<h2 id="配置网关"><a href="#配置网关" class="headerlink" title="配置网关"></a>配置网关</h2><p>同样利用ssh，查看自己路由器的默认ipv6网关<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip -6 route | grep default</span><br></pre></td></tr></table></figure></p>
<p>得到的结果类似于<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default from (your ipv6) via (gateway) dev eth0.2 proto static metric 512</span><br></pre></td></tr></table></figure></p>
<p>(gateway)的部分就是你的默认ipv6网关</p>
<p>执行下列命令设置你的默认ipv6网关<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -A inet6 add default gw &lt;your default gw&gt; dev eth0.2</span><br></pre></td></tr></table></figure></p>
<p>执行下列命令重启防火墙和网络使设置生效<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/firewall restart</span><br><span class="line">/etc/init.d/network restart</span><br></pre></td></tr></table></figure></p>
<h2 id="配置开机自动设置ipv6路由默认网关"><a href="#配置开机自动设置ipv6路由默认网关" class="headerlink" title="配置开机自动设置ipv6路由默认网关"></a>配置开机自动设置ipv6路由默认网关</h2><p>上述配置在重启路由器后会失效，需要在开机的时候自动设置网关。</p>
<p>在/etc/hotplug.d/iface/目录下新建名字为 90-ipv6 的文件<br>修改内容为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">[ <span class="string">"<span class="variable">$ACTION</span>"</span> = ifup ] || <span class="built_in">exit</span> 0</span><br><span class="line">route -A inet6 add default gw &lt;your default gw&gt; dev eth0.2</span><br></pre></td></tr></table></figure>
<p>给予可执行权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 90-ipv6</span><br></pre></td></tr></table></figure></p>
<h2 id="配置DNS服务器"><a href="#配置DNS服务器" class="headerlink" title="配置DNS服务器"></a>配置DNS服务器</h2><p>DNS有可能被污染 手动修改wan6的dns方法是：</p>
<ol>
<li>修改wan6-高级设置 </li>
<li>取消勾选对端通告的DNS服务器 </li>
<li>自定义为谷歌的v6dns</li>
</ol>
<p><a href="https://imgchr.com/i/Cbf01K" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/Cbf01K.md.png" alt="Cbf01K.md.png"></a></p>
<h2 id="测试IPv6是否正常"><a href="#测试IPv6是否正常" class="headerlink" title="测试IPv6是否正常"></a>测试IPv6是否正常</h2><p>通过 <a href="http://test-ipv6.com/" target="_blank" rel="noopener">http://test-ipv6.com/</a> </p>
<p>或者 <a href="http://ipv6-test.com/" target="_blank" rel="noopener">http://ipv6-test.com/</a></p>
<p>测试IPv6是否正常</p>
<p><a href="https://imgchr.com/i/Cbfsne" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/06/09/Cbfsne.md.jpg" alt="Cbfsne.md.jpg"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/06/07/why-java-md5-0xff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/07/why-java-md5-0xff/" class="post-title-link" itemprop="url">为什么Java取MD5哈希值的时候要&0xff</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-06-08 03:50:39 / Modified: 17:26:25" itemprop="dateCreated datePublished" datetime="2018-06-08T03:50:39+09:00">2018-06-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/07/why-java-md5-0xff/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/07/why-java-md5-0xff/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>想要得到字符串的MD5哈希值怎么办？<br>先来了解一下MD5哈希值的概念。</p>
<h2 id="MD5散列"><a href="#MD5散列" class="headerlink" title="MD5散列"></a>MD5散列</h2><p>一般128位的MD5散列被表示为32位十六进制数字。以下是一个43位长的仅ASCII字母列的MD5散列：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MD5(<span class="string">"The quick brown fox jumps over the lazy dog"</span>)</span><br><span class="line">= <span class="number">9e107</span>d9d372bb6826bd81d3542a419d6</span><br></pre></td></tr></table></figure></p>
<p>即使在原文中作一个小变化（比如用c取代d）其散列也会发生巨大的变化：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MD5(<span class="string">"The quick brown fox jumps over the lazy cog"</span>)</span><br><span class="line">= <span class="number">1055</span>d3e698d289f2af8663725127bd4b</span><br></pre></td></tr></table></figure></p>
<p>也就是说，给你一串字符串，你要把它转换成固定长度的散列。</p>
<p>##用Java来实现MD5哈希值<br>Java中可以这样实现:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String password = <span class="string">"123456"</span>;</span><br><span class="line">		</span><br><span class="line">   MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">   md.update(password.getBytes());</span><br><span class="line">   <span class="keyword">byte</span> byteData[] = md.digest();</span><br><span class="line">		</span><br><span class="line">   <span class="comment">//convert the byte to hex format method 1</span></span><br><span class="line">   StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; byteData.length; i++) &#123;</span><br><span class="line">    sb.append(Integer.toString((byteData[i] &amp; <span class="number">0xff</span>) + <span class="number">0x100</span>, <span class="number">16</span>).substring(<span class="number">1</span>));</span><br><span class="line">   &#125;</span><br><span class="line">   System.out.println(<span class="string">"Digest(in hex format):: "</span> + sb.toString());</span><br></pre></td></tr></table></figure></p>
<h2 id="byte数值转换为int数值时的注意事项"><a href="#byte数值转换为int数值时的注意事项" class="headerlink" title="byte数值转换为int数值时的注意事项"></a>byte数值转换为int数值时的注意事项</h2><p>那么问题来了，下面这行代码做的是啥？<br><code>Integer.toString((byteData[i] &amp; 0xff) + 0x100, 16).substring(1)</code><br>这行语句其实是将byteData中的byte类型的数据转换成十六进制的数据进行表示。<br>为什么这么复杂？<br>是因为要考虑到byteData中的负数。</p>
<p>考虑一下下面这段代码，试图将byte类型表示为16进制形式的字符串<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testByteInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">byte</span> a = <span class="number">127</span>;</span><br><span class="line">	print(a);</span><br><span class="line">	<span class="keyword">byte</span> b = -<span class="number">127</span>;</span><br><span class="line">	print(b);</span><br><span class="line">	<span class="keyword">byte</span> c = <span class="number">2</span>;</span><br><span class="line">	print(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">byte</span> b)</span> </span>&#123;</span><br><span class="line">	System.out.println(Integer.toBinaryString(b));</span><br><span class="line">	System.out.println(Integer.toBinaryString(b &amp; <span class="number">0xff</span>));</span><br><span class="line">	System.out.println(Integer.toHexString(b));</span><br><span class="line">	System.out.println(Integer.toHexString(b &amp; <span class="number">0xff</span>));</span><br><span class="line">	System.out.println(Integer.toString(b, <span class="number">16</span>));</span><br><span class="line">	System.out.println(Integer.toString(b &amp; <span class="number">0xff</span>, <span class="number">16</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1111111</span><br><span class="line">1111111</span><br><span class="line">7f</span><br><span class="line">7f</span><br><span class="line">7f</span><br><span class="line">7f</span><br><span class="line">11111111111111111111111110000001</span><br><span class="line">10000001</span><br><span class="line">ffffff81</span><br><span class="line">81</span><br><span class="line">-7f</span><br><span class="line">81</span><br><span class="line">10</span><br><span class="line">10</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<p>从输出结果可以看出几个问题。</p>
<ul>
<li>String的几个函数接收byte类型的参数时自动将其转换为int类型</li>
<li>int类型的负数<code>-127</code>用2进制数据来表示的时候，会用符号位补全，变成<code>11111111111111111111111110000001</code>, 而这个2进制的数据再用16进制来表示的时候却成了<code>ffffff81</code>，与<code>-127</code>的16进制表示<strong>不一致</strong>。</li>
<li>负数的十六进制表现形式例如<code>-7f</code>不符合哈希值的要求。哈希值中不能带有负号。所以需要将其转换一下。</li>
<li>比较小的数值，例如<code>2</code>，转换成的16进制字符串也是<code>2</code>，不符合哈希值的长度要求。哈希值要求每个byte用2个16进制的字符来表示。</li>
</ul>
<p>要解决上面两个问题，前面的java程序给出的答案是：</p>
<ul>
<li>用<code>&amp; 0xff</code>来对byte数值进行补零扩展</li>
<li>用<code>+ 0x100</code>来保证每个数转换成16进制后会得到3个字符</li>
<li>用<code>.subString(1)</code>来去掉3个字符的第一个字符</li>
</ul>
<p>这样就能得到2个16进制的字符了。<br>循环一遍，就能得到相应的MD5哈希字符串了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/06/06/hexo-generate-no-response/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/06/hexo-generate-no-response/" class="post-title-link" itemprop="url">Hexo Generate 没有反应的原因</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-06-07 00:05:00 / Modified: 00:09:48" itemprop="dateCreated datePublished" datetime="2018-06-07T00:05:00+09:00">2018-06-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/06/hexo-generate-no-response/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/06/hexo-generate-no-response/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在hexo执行下列命令时，没有看到生成的结果，只看到了一个kill之类的中断语句。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure></p>
<p>原因很可能是你的服务器（vps）swap不足。<br>通过执行下列命令可以增加swap内存。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dd <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1024 count=1024k</span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2018/05/10/understand-spring-di-aop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/understand-spring-di-aop/" class="post-title-link" itemprop="url">理解Spring中的DI和AOP</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-10 18:55:25" itemprop="dateCreated datePublished" datetime="2018-05-10T18:55:25+09:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-06-06 22:49:12" itemprop="dateModified" datetime="2018-06-06T22:49:12+09:00">2018-06-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/05/10/understand-spring-di-aop/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/10/understand-spring-di-aop/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题的提出"><a href="#问题的提出" class="headerlink" title="问题的提出"></a><strong>问题的提出</strong></h1><p>Spring中的依赖注入（DI)为何而生？<br> 下面这篇日语文章提到，所有的Web应用都需要考虑到下面三个问题。[] <a href="http://penguinlabo.wp.xdomain.jp/understandspringmvc/" target="_blank" rel="noopener">http://penguinlabo.wp.xdomain.jp/understandspringmvc/</a></p>
<ol>
<li>对象的生命周期问题。<br>假设你用Servlet来接收用户的访问请求，有一个用户需要访问一个页面，你就需要一个线程来负责处理这个请求，并调用某个业务逻辑（比如调用一个UserService的实例）。如果处理不当，每新增一个用户就实例化一个业务逻辑（new一个UserService的实例），随着访问用户的增多，就会给系统带来大量垃圾回收负担，以及内存消耗的问题。为了防止这种情况发生，就需要把业务逻辑的部分设计为Singleton的，这样就不会每次都新增一个实例</li>
<li>松耦合问题。<br>为了实现Web程序中的松耦合，即让一个类与另一个类不是那么的紧密结合，通常需要接口（Interface）来实现。但是单存的利用Interface并不能实现松耦合。还需要利用一些技巧，比如Factory Method等设计模式。 </li>
<li>技术细节的隐藏。<br>当你写一个User或者SalesOrder类的时候，你希望专注于自己的业务逻辑，比如创建用户，删除用户，创建订单，删除订单这些具体的业务。如果你在这些类中再加上访问记录（log）处理，就会明显的影响你程序的可读性。因为本质上log处理和你的业务逻辑没有什么联系，两者混杂在一起就会让人看起来比较头大。还有一些异常处理类的逻辑也会产生同样的问题。你怎样才能把这些和真正的业务逻辑无关的逻辑分离出去？</li>
</ol>
<h1 id="问题的回答"><a href="#问题的回答" class="headerlink" title="问题的回答"></a>问题的回答</h1><p>Spring给出的解决方案是这样的。<br>1）对象的生命周期问题。=&gt;DI<br>2）松耦合问题。 =&gt; DI<br>3）技术细节的隐藏。=&gt;AOP </p>
<p>首先Spring是怎么实现DI的呢，是通过DI Container来实现的。<br>在没有使用DI的Web应用中，Controller用到Service的时候，会生成（new）一个，Service用到DAO的时候，也是同样的生成（new）一个。 <img src="http://65.49.230.2/wordpress/wp-content/uploads/2018/06/no-di-300x187.jpg" alt=""> 而使用了DI的Spring，则将实例化的工作全部交给了DI Container去做。 Controller中仅仅声明了Service接口的一个属性，具体的实现（new）没有去做，同样Service中也只是声明了一个DAO接口的一个属性，也没有去实现（new）。当需要实例的时候，就让DI Container根据配置去找到合适的类去实例化相应的接口属性。 <img src="http://65.49.230.2/wordpress/wp-content/uploads/2018/06/DI-300x186.png" alt=""> 而用Spring写成的Web程序，其处理顺序可以用下图来表示 <img src="http://65.49.230.2/wordpress/wp-content/uploads/2018/06/Spring-flow-300x195.png" alt=""></p>
<ol>
<li>Dispatcher Servlet接收用户访问请求</li>
<li>Dispatcher Servlet利用HandlerMapping取得URL所对应的Controller对象</li>
<li>Controller来实行业务逻辑，调用Service对象和DAO对象得到业务数据，并把数据放到Model中。并返回一个View的名字，希望把数据显示到该View上。</li>
<li>Dispatcher Servlet得到View的名字后，调用View Resolver来得到相应的View对象。</li>
<li>Dispatcher Servlet把View对象生成为一个画面（View），画面包含Model对象中的数据，然后把这个View返回给用户(response)。用户的浏览器把这个画面呈献给用户。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://leowll.com/2017/02/20/my-understandng-of-javascript-closure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Wang">
      <meta itemprop="description" content="Tech & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's notepad">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/20/my-understandng-of-javascript-closure/" class="post-title-link" itemprop="url">我对Javascript中的闭包Closure的理解</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-21 12:25:27" itemprop="dateCreated datePublished" datetime="2017-02-21T12:25:27+09:00">2017-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-06-06 23:39:37" itemprop="dateModified" datetime="2018-06-06T23:39:37+09:00">2018-06-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2017/02/20/my-understandng-of-javascript-closure/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/02/20/my-understandng-of-javascript-closure/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>怎样理解 Javascript Closure 也就是闭包的概念，想必很多人在为此头疼。 笔者先后参考了下面这些资料 </p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">MDN Javascript Closure</a> </li>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="noopener">阮一峰的博客</a> </li>
<li><a href="http://www.cnblogs.com/frankfang/archive/2011/08/03/2125663.html" target="_blank" rel="noopener">Frank Fang的博客</a> </li>
</ul>
<p>作者们都声称自己搞懂了闭包的概念，可自己还是看的云里雾里。 直到笔者看到下面这篇文章，才开始真正理解闭包的概念和应用场景。 Jonathan D. Johnson的博客 <a href="http://jondavidjohn.com/javascript-closure-explained-using-events/" target="_blank" rel="noopener">http://jondavidjohn.com/javascript-closure-explained-using-events/</a> 下面我试着把这篇文章边翻译边把自己的理解写出来。 先看一下下面这段程序， 效果：在第3次按下button的时候显示”Third time’s the charm”的消息框。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// declare counter outside event handler's scope</span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">"button"</span>);</span><br><span class="line"></span><br><span class="line">element.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// increment outside counter</span></span><br><span class="line">    counter++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (counter === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="comment">// do something every third time</span></span><br><span class="line">        alert(<span class="string">"Third time's the charm!"</span>);</span><br><span class="line">        <span class="comment">// reset counter</span></span><br><span class="line">        counter = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>程序中声明了一个全局变量counter,每次按下button都会唤起程序，从而让counter++ 如果你只在自己的网页中执行一次的话，这么写也无所谓，但是如果你想在其他地方复用的话， 最好还是把这段程序封装成单独的一个函数。 这时问题就来了，你要每次都声明一个外部的全局变量counter吗？很明显这种做法太笨拙。 于是closure的作用就发挥出来了。 如果你看过了MDN的解释，就会知道closure其实是这样一种机制，</p>
<blockquote>
<p>函数可以访问它被创建时所处的作用域中的对象（Object）。</p>
</blockquote>
<p>于是上面那段程序利用闭包可以优化成下面这种形式：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"button1"</span> <span class="attr">value</span>=<span class="string">"button1"</span> <span class="attr">class</span>=<span class="string">"button"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"button2"</span> <span class="attr">value</span>=<span class="string">"button2"</span> <span class="attr">class</span>=<span class="string">"button"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> myClosureFunc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// init the count to 0</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//count</span></span></span><br><span class="line"><span class="undefined">            count++;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (count === <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// do something every third time</span></span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"Third time's the charm!"</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">//reset counter</span></span></span><br><span class="line"><span class="undefined">                count = 0;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> element1 = <span class="built_in">document</span>.getElementById(<span class="string">"button1"</span>);</span></span><br><span class="line"><span class="undefined">    element1.onclick = myClosureFunc();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> element2 = <span class="built_in">document</span>.getElementById(<span class="string">"button2"</span>);</span></span><br><span class="line"><span class="undefined">    element2.onclick = myClosureFunc();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>  counter的位置移到了event handler函数的内部，而函数的返回值为一个闭包。 按照上面的概念，myClosureFunc中的闭包可以访问它创建时所处的作用域(scope), 于是它就可以访问自己的counter，而这个counter是<strong>相对</strong>全局的，也就是说，在element1被按下的过程中，这个counter是共有的。 而element1和element2中的counter又是<strong>相对独立</strong>的。 怎么样，有没有帮你理解closure在作用域这个概念里所起的作用？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Leo Wang</p>
  <div class="site-description" itemprop="description">Tech & Life</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Wang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.7.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script><script src="/js/algolia-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://leowll.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
